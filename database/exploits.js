let Database = require('./database');

class Exploits {
  constructor() {
    this.table = 'exploits';
    this.id = 'id';
    this.file = 'file';
    this.description = 'description';
    this.date = '_date';
    this.author = 'author';
    this.platform = 'platform';
    this.type = 'type';
    this.port = 'port';
  }

  async searchExploit(term, filter) {
    let database = new Database();

    let searchTerm = '%' + term + '%';
    let query = `SELECT * FROM ${this.table} WHERE ${filter} LIKE ?`;
    let options = [searchTerm];
    return await database.query(query,options)
      .then(response => {
        return response;
      })
      .catch(err => {
        throw(err);
      })
      .finally(database.close());
  }

  async getExploit(id) {
    let database = new Database();
    
    let query = `SELECT * FROM ${this.table} WHERE ${this.id} = ?`;
    let options = [id];
    return await database.query(query, options)
      .then(response => {
        return response[0];
      })
      .catch(err => {
        throw(err);
      })
      .finally(database.close());
  }
}

module.exports = Exploits;
