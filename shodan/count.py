import shodan
import mysql.connector
import sys

API_KEY = sys.argv[1]
api = shodan.Shodan(API_KEY)
name = sys.argv[2]
results = api.count(name)
try:
    connection = mysql.connector.connect(user='root', password='cybersecurity', host='127.0.0.1', database='exploitdb')
    cursor = connection.cursor()
    if connection.is_connected():
        mysql_query = """INSERT INTO count (name, number) Values(%s, %s)"""
        cursor.execute(mysql_query, (name, results['total']))
        connection.commit()
except Error as e:
    print ("Mysql error")
finally:
    if (connection.is_connected()):
        cursor.close()
        connection.close()
        print("MySQL connection is closed")
