import shodan
import mysql.connector
import sys

API_KEY = sys.argv[1]
api = shodan.Shodan(API_KEY)
ip = sys.argv[2]
results = api.host(ip)

try:
    conn = mysql.connector.connect(user='root', password='cybersecurity', host='127.0.0.1', database='exploitdb')
    cursor = conn.cursor()
    if conn.is_connected():
        hostnames = (str(results['hostnames']))
        hostnamestr = str(hostnames)[1:-1]
        domains = (str(results['domains']))
        domainstr = str(domains)[1:-1]
        ports = (str(results['ports']))
        portstr = str(ports)[1:-1]
        mysql_query =  """INSERT INTO shodan (ip, hostnames, city, country, domains, org, os, port, isp) Values(%s, %s, %s, %s, %s, %s, %s, %s, %s)"""
        cursor.execute(mysql_query, (ip, hostnamestr, results['city'], results['country_name'], domainstr, results['org'], results['os'], portstr, results['isp']))
        conn.commit()
except Error as e:
    print ("Mysql error")
finally:
    if (conn.is_connected()):
        cursor.close()
        conn.close()
        print("MySQL conn is closed")
